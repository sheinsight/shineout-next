# Diff 报告生成标准操作流程

## 一、准备工作

### 1.1 收集信息
1. 从 `__doc__/changelog.cn.md` 中获取版本号和变更描述
2. 查找相关的 PR 编号和 commit hash
3. 使用 `git show <commit-hash> --stat` 查看变更文件列表
4. 使用 `git show <commit-hash> -- <file-path>` 查看具体代码变更

### 1.2 分析变更类型
- **新功能**：新增属性、方法或能力
- **缺陷修复**：修复 bug、错误行为
- **优化改进**：性能优化、代码重构、样式调整

## 二、标准章节结构

### 必需章节（按顺序）
1. **标题**：`# [组件名] 组件 [版本号] 版本 Diff 报告`
2. **问题描述**
3. **代码变更文件**
4. **变更代码行**
5. **变更前后逻辑差异**
6. **逻辑影响范围**
7. **升级注意事项**（包含"代码兼容性"和"行为变化说明"两个子章节）

### 禁止添加的章节
- 测试建议
- 总结（除非是多个功能的综合性版本）
- 任何编号形式的章节标题（如 ## 1. 问题描述）

## 三、各章节编写规范

### 3.1 问题描述
```markdown
## 问题描述

[一句话概括本版本的核心变更]。[详细描述具体问题或新增功能]。

# 示例：
修复 `Component` 在特定场景下的显示错误问题。当组件在...情况下，会出现...问题，导致...。
```

### 3.2 代码变更文件
```markdown
## 代码变更文件

1. `packages/base/src/component/component.tsx`
2. `packages/base/src/component/component.type.ts`
3. `packages/shineout-style/src/component/component.ts`
```

### 3.3 变更代码行
```markdown
## 变更代码行

### 1. packages/base/src/component/component.tsx - [变更说明]
```diff
// diff 格式展示具体代码变更
- 旧代码
+ 新代码
```
```

### 3.4 变更前后逻辑差异
```markdown
## 变更前后逻辑差异

### 变更前
- 具体行为描述
- 存在的问题或限制
- 原有逻辑说明

### 变更后
- 新的行为描述
- 问题如何被解决
- 新逻辑说明
```

### 3.5 逻辑影响范围
```markdown
## 逻辑影响范围
- 影响的功能点
- 不影响的功能点
- 性能或行为变化
```

### 3.6 升级注意事项
```markdown
## 升级注意事项

### 代码兼容性
- **无破坏性变更**：[说明]
或
- **破坏性变更**：[具体说明]

### 行为变化说明

1. **[变化点概括]**：
   - 影响场景：[具体使用场景]
   - 具体表现：[变化前后的表现]
   - 受影响代码示例：
   ```tsx
   // 之前：[旧行为]
   // 现在：[新行为]
   <Component 
     prop="value"
   />
   ```
   - 是否需要调整：[不需要/需要，具体说明]
```

## 四、标准化模板

```markdown
# [组件名] 组件 [版本号] 版本 Diff 报告

## 问题描述

[核心变更概述]。[详细问题描述，包括场景、原因、影响]。

## 代码变更文件

1. `[文件路径1]`
2. `[文件路径2]`

## 变更代码行

### 1. [文件路径] - [变更说明]
```diff
[具体的代码 diff]
```

## 变更前后逻辑差异

### 变更前
- [行为/逻辑点1]
- [行为/逻辑点2]

### 变更后
- [新行为/逻辑点1]
- [新行为/逻辑点2]

## 逻辑影响范围
- [影响点1]
- [影响点2]
- [不影响的点]

## 升级注意事项

### 代码兼容性
- **[无/有]破坏性变更**：[说明]

### 行为变化说明

1. **[变化概括]**：
   - 影响场景：[场景描述]
   - 具体表现：[前后对比]
   - 受影响代码示例：
   ```tsx
   [代码示例]
   ```
   - 是否需要调整：[是/否，原因]
```

## 五、质量检查清单

生成报告后，检查以下要点：

- [ ] 标题格式正确（组件名、版本号）
- [ ] 包含所有必需的 7 个章节
- [ ] 没有使用数字编号的章节标题
- [ ] 代码 diff 格式正确
- [ ] 有具体的代码示例
- [ ] 升级注意事项包含兼容性和行为变化说明
- [ ] 没有测试建议章节
- [ ] 语言简洁、准确、专业

## 六、常见问题类型模板

### 6.1 缺陷修复类
```markdown
## 问题描述
修复 `[组件]` [具体问题]的问题。[问题发生的场景和影响]。
```

### 6.2 新功能类
```markdown
## 问题描述
`[组件]` 新增 `[属性/功能]` [功能说明]。[为什么需要这个功能，解决什么问题]。
```

### 6.3 优化改进类
```markdown
## 问题描述
优化 `[组件]` [优化点]。[原有问题或不足，优化后的效果]。
```

## 七、自动化脚本命令

```bash
# 1. 查看组件的 changelog
cat packages/shineout/src/[component]/__doc__/changelog.cn.md

# 2. 查找相关 commit
git log --oneline --grep="[关键词]" -i

# 3. 查看 commit 详情
git show [commit-hash] --stat

# 4. 查看具体文件变更
git show [commit-hash] -- [file-path]

# 5. 生成 diff-imports.ts
pnpm run generate:diff-imports
```