# Diff 报告编写检查清单

## 一、信息收集阶段

### 1. 版本和变更信息
- [ ] 从 `__doc__/changelog.cn.md` 获取准确的版本号
- [ ] 记录 PR 编号（如 #659）
- [ ] 找到对应的 commit hash
- [ ] 确认变更类型：新功能 / 缺陷修复 / 优化改进

### 2. 代码分析
```bash
# 查看 commit 概览
git show <commit-hash> --stat

# 查看具体文件变更
git show <commit-hash> -- <file-path>

# 搜索相关 commits
git log --oneline --grep="<keyword>" -i
```

## 二、内容编写阶段

### 1. 标题格式
✅ 正确：`# Menu 组件 3.4.0 版本 Diff 报告`
❌ 错误：`# Menu 3.4.0 Diff 报告`
❌ 错误：`# Menu 组件 v3.4.0 版本 Diff 报告`

### 2. 问题描述编写要点
- [ ] 第一句话概括核心变更
- [ ] 使用反引号标记组件名和属性名
- [ ] 说明变更的原因和背景
- [ ] 避免技术细节，focus 在用户影响

#### 示例模板：
```markdown
## 问题描述

修复 `Component` [具体问题]的问题。[问题场景描述，影响说明]。

`Component` 新增 `property` 属性[功能说明]。[解决的问题或使用场景]。

优化 `Component` [优化点]。[原有不足，优化后效果]。
```

### 3. 代码变更文件
- [ ] 使用完整相对路径
- [ ] 按照逻辑顺序排列（类型定义 → 实现 → 样式）
- [ ] 使用反引号包裹路径

### 4. 变更代码行
- [ ] 每个文件单独一个子标题
- [ ] 标题包含文件路径和变更说明
- [ ] diff 代码块使用正确的语法高亮
- [ ] 只展示关键变更，避免过长的 diff

#### 格式示例：
```markdown
### 1. packages/base/src/component/component.tsx - 实现新功能
```diff
+ const newFeature = props.feature || defaultValue;
```
```

### 5. 变更前后逻辑差异
- [ ] 使用"变更前"和"变更后"两个子标题
- [ ] 每个要点一行，使用短横线开头
- [ ] 说明行为变化，而非代码变化
- [ ] 避免重复"变更代码行"的内容

### 6. 逻辑影响范围
- [ ] 列出受影响的功能点
- [ ] 明确指出不受影响的部分
- [ ] 评估对现有用户的影响

### 7. 升级注意事项

#### 代码兼容性
- [ ] 明确标注是否有破坏性变更
- [ ] 使用加粗标记：**无破坏性变更** 或 **破坏性变更**

#### 行为变化说明
- [ ] 每个变化点单独编号
- [ ] 包含四个要素：影响场景、具体表现、代码示例、是否需要调整
- [ ] 代码示例要有"之前/现在"的对比注释
- [ ] 明确告知用户是否需要修改代码

## 三、格式规范检查

### 必须包含的章节（按顺序）
1. [ ] 标题（一级标题）
2. [ ] 问题描述（二级标题）
3. [ ] 代码变更文件（二级标题）
4. [ ] 变更代码行（二级标题）
5. [ ] 变更前后逻辑差异（二级标题）
6. [ ] 逻辑影响范围（二级标题）
7. [ ] 升级注意事项（二级标题）

### 禁止出现的内容
- [ ] 不使用 `## 1.` 这样的编号章节标题
- [ ] 不添加"测试建议"章节
- [ ] 不在最后添加"总结"章节（除非是多功能综合版本）
- [ ] 不使用 emoji（除非复制 commit message）

## 四、常见错误示例

### ❌ 错误的章节标题
```markdown
## 1. 问题描述
## 2. 代码变更文件
## 6. 测试建议
## 7. 总结
```

### ✅ 正确的章节标题
```markdown
## 问题描述
## 代码变更文件
## 升级注意事项
```

### ❌ 错误的代码示例
```tsx
<Component prop="value" />  // 没有说明前后变化
```

### ✅ 正确的代码示例
```tsx
// 之前：属性不生效
// 现在：正确响应
<Component 
  size="small"
  value={data}
/>
```

## 五、最终检查

提交前确认：
- [ ] 所有必需章节都存在且顺序正确
- [ ] 没有使用编号的章节标题
- [ ] 代码示例包含前后对比
- [ ] 明确告知用户是否需要调整代码
- [ ] 语言简洁专业，避免口语化
- [ ] 运行 `pnpm run generate:diff-imports` 更新导入

## 六、快速命令参考

```bash
# 生成模板
node scripts/diff-report-template.js

# 查看 changelog
cat packages/shineout/src/<component>/__doc__/changelog.cn.md

# 搜索 commits
git log --oneline --grep="<keyword>" -i

# 查看变更
git show <commit> --stat
git show <commit> -- <file>

# 更新导入
pnpm run generate:diff-imports
```